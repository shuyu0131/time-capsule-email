<p align="center">
  <img src="./assets/images/banner.jpeg" width="600" />
</p>

<p align="center"><b>时光邮局</b></p>
<p align="center">WordPress 时光邮局插件</p>

<p align="center">
<img alt="Version" src="https://img.shields.io/badge/version-1.0.1-blue.svg?style=flat-square" />
<img alt="WordPress" src="https://img.shields.io/badge/WordPress-5.0+-green.svg?style=flat-square" />
<img alt="PHP" src="https://img.shields.io/badge/PHP-7.2+-purple.svg?style=flat-square" />
<img alt="License" src="https://img.shields.io/badge/license-GPL%20v2-orange.svg?style=flat-square" />
</p>

## 简介

一款 WordPress 插件，让用户通过电子邮件记录当下，设置未来的发送时间，让未来的自己收到过去的消息。无论是一年后还是五年后，这封信都会准时送达。

## 主要功能

- **时光邮件** - 写信给未来的自己或他人，设定发送日期
- **富文本编辑器** - 基于 Quill 的强大编辑器，支持格式化文本、图片、代码等
- **邮箱验证** - 可选的邮箱验证功能，防止垃圾邮件
- **公开信广场** - 用户可选择将信件设为公开，与他人分享
- **SMTP 支持** - 支持自定义 SMTP 服务器，确保邮件送达
- **邮件模板** - 可自定义邮件模板样式
- **SEO 优化** - 内置 SEO 设置，支持自定义标题、描述、关键词和分享图片
- **定时任务** - 自动化的邮件发送系统
- **响应式设计** - 完美适配移动端和桌面端
- **多用户支持** - 每个用户独立管理自己的时光邮件

## 环境要求

* WordPress 5.0 及以上，暂时不要使用6.9版本！！！
* PHP 7.2 及以上
* MySQL 5.6 及以上
* 服务器环境推荐：Linux + Nginx/Apache
* 浏览器推荐：Chrome、Edge、Firefox、Safari

## 更新说明
- **V1.0.1**  修复了"设为公开信"复选框点击无反应的问题

## 安装方法

### 方法一：WordPress 后台安装

1. 下载插件 zip 安装包
2. 登录 WordPress 后台
3. 进入「插件」→「安装插件」→「上传插件」
4. 选择下载的 zip 文件并上传
5. 点击「现在安装」
6. 安装完成后点击「启用插件」

### 方法二：FTP 上传安装

1. 下载插件并解压
2. 将解压后的 `time-capsule-email` 文件夹上传到 `/wp-content/plugins/` 目录
3. 登录 WordPress 后台
4. 进入「插件」页面
5. 找到「时光邮局」并点击「启用」

## 快速开始

### 1. 基础配置

启用插件后，进入「设置」→「时光邮局」进行配置：

**邮箱配置**
- 发件人姓名：邮件发件人显示的名称
- 发件人邮箱：邮件发件人邮箱地址
- 回复邮箱：回复邮件的接收地址（可选）
- 启用邮箱验证：开启后用户需验证邮箱才能发送时光邮件
- 启用公开信功能：允许用户将信件设为公开

**SEO 设置**
- 页面标题：前台页面的标题
- 页面描述：搜索引擎显示的描述
- 页面关键词：SEO 关键词
- 分享图片：社交媒体分享时显示的图片

**SMTP 设置**（可选，推荐配置以提高送达率）
- 启用 SMTP：使用专业邮件服务发送
- SMTP 主机：如 smtp.qq.com
- SMTP 端口：通常为 587（TLS）或 465（SSL）
- SMTP 用户名：邮箱账号
- SMTP 密码：邮箱密码或授权码
- SMTP 加密：选择 TLS 或 SSL

### 2. 创建页面

1. 创建新页面（如「时光邮局」）
2. 在页面内容中添加短代码：`[time_capsule_email]`
3. 发布页面

### 3. 创建公开信广场（可选）

1. 创建新页面（如「公开信广场」）
2. 在页面内容中添加短代码：`[time_capsule_public]`
3. 发布页面

### 4. 测试邮件

1. 在设置页面填写测试邮箱
2. 点击「发送测试邮件」按钮
3. 检查邮箱是否收到测试邮件
4. 如使用 SMTP，可点击「测试 SMTP 连接」验证配置

## 使用说明

### 写一封时光邮件

1. 访问创建的时光邮局页面
2. 登录 WordPress 账号
3. 填写收件邮箱、邮件主题
4. 使用富文本编辑器编写邮件内容
5. 选择发送日期（必须是未来日期）
6. 可选：勾选「设为公开信」
7. 点击「保存时光邮件」

### 管理邮件

- **待发送**：查看、编辑或删除尚未发送的邮件
- **已发送**：查看已发送的邮件历史
- **公开信广场**：浏览其他用户分享的公开信件

### 邮箱验证流程

如果启用了邮箱验证功能：

1. 用户写信后会收到一封验证邮件
2. 点击验证邮件中的链接完成验证
3. 验证成功后，时光邮件会在指定日期自动发送
4. 未验证的邮件不会被发送

## 定时任务

插件使用 WordPress Cron 系统自动发送邮件和计划任务脚本：

- 每天检查一次待发送的邮件
- 自动发送到期的邮件
- 无需手动干预

如果邮件未按时发送，可能是服务器的 Cron 未正常工作，建议：
- 使用计划任务脚本替代 WordPress Cron
- 或安装 WP Crontrol 插件检查定时任务状态

## 自定义邮件模板

在「邮件模板设置」中可以自定义邮件样式：

**可用变量**
- `{{title}}` - 邮件标题
- `{{content}}` - 邮件正文内容
- `{{site_name}}` - 网站名称
- `{{site_url}}` - 网站地址

模板支持完整的 HTML 和 CSS，可以根据需要自由定制。

## 常见问题

### 邮件无法发送？

1. 检查 WordPress 邮件功能是否正常
2. 尝试配置 SMTP 服务
3. 检查服务器是否限制邮件发送
4. 查看 WordPress 调试日志

### SMTP 连接失败？

1. 确认 SMTP 服务器地址和端口正确
2. 检查用户名和密码是否正确
3. 某些邮箱需要使用授权码而非密码
4. 确认选择了正确的加密方式（TLS/SSL）

### 邮件进入垃圾箱？

1. 配置 SMTP 使用专业邮件服务
2. 设置正确的发件人邮箱
3. 避免在邮件中使用敏感词汇
4. 建议使用企业邮箱或专业邮件服务

### 定时任务不工作？

1. 检查 WordPress Cron 是否正常
2. 安装 WP Crontrol 插件查看定时任务
3. 考虑使用计划任务脚本替代

## 技术支持

- 作者：属余
- QQ：1659872714
- 作者网站：https://waikanl.cn/
- 插件版本：1.0.0
- 最低 WordPress 版本：5.0
- 最低 PHP 版本：7.2

## 授权协议

本插件基于 GPL v2 或更高版本授权发布。

详见：[LICENSE](https://www.gnu.org/licenses/gpl-2.0.html)

## 致谢

感谢所有使用和支持时光邮局的用户！

---

<p align="center">用时光邮局，给未来写封信 ✉️</p>
